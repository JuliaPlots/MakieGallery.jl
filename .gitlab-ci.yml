variables:
  CI_IMAGE_TAG: "opengl"
  MODERNGL_DEBUGGING: "true"
  JULIA_DEPOT_PATH: "$CI_PROJECT_DIR/.julia/"
  CI_DEV_PKGS: ""

stages:
  - documentation

docs:
  stage: documentation
  tags:
      - xorg

  image: "juliagpu/julia:v1.3-${CI_IMAGE_TAG}"

  cache:
    key: ${CI_JOB_NAME}
    paths:
      - .julia/

  before_script:
      - apt-get -qq update
      # glfw
      - apt-get install -y cmake xorg-dev mesa-utils p7zip-full

  script:
    - mkdir -p $JULIA_DEPOT_PATH # Pkg.jl#325
    - glxinfo | grep 'version'
    - julia -e 'using InteractiveUtils; versioninfo()'
    - julia --project=docs/ -e 'using Pkg; Pkg.develop(PackageSpec(path=pwd())); Pkg.instantiate()'
    - julia --project=docs/ docs/make.jl

  rules:
    - if: '$CI_COMMIT_BRANCH == "master"' # trigger docs on master branch changes
    # Also specifically trigger docs on PRs (only internal, not from forks).
    # This should not double trigger pipelines because pull requests come from
    # other branches than master.
    # This is needed, because if not triggered via a specific rule, Github PRs don't
    # trigger CI in Gitlab
    - if: '$CI_PIPELINE_SOURCE == "external_pull_request_event"'
    
